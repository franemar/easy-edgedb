<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Chapter 8 - Dracula takes the boat to England</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Introduction</a></li><li class="chapter-item expanded "><a href="../chapter1/index.html"><strong aria-hidden="true">1.</strong> Chapter 1 - Jonathan Harker travels to Transylvania</a></li><li class="chapter-item expanded "><a href="../chapter2/index.html"><strong aria-hidden="true">2.</strong> Chapter 2 - At the Hotel in Bistritz</a></li><li class="chapter-item expanded "><a href="../chapter3/index.html"><strong aria-hidden="true">3.</strong> Chapter 3 - Jonathan goes to Castle Dracula</a></li><li class="chapter-item expanded "><a href="../chapter4/index.html"><strong aria-hidden="true">4.</strong> Chapter 4 - "What a strange man this Count Dracula is."</a></li><li class="chapter-item expanded "><a href="../chapter5/index.html"><strong aria-hidden="true">5.</strong> Chapter 5 - Jonathan tries to leave the castle</a></li><li class="chapter-item expanded "><a href="../chapter6/index.html"><strong aria-hidden="true">6.</strong> Chapter 6 - Still no escape</a></li><li class="chapter-item expanded "><a href="../chapter7/index.html"><strong aria-hidden="true">7.</strong> Chapter 7 - Jonathan finally "leaves" the castle</a></li><li class="chapter-item expanded "><a href="../chapter8/index.html" class="active"><strong aria-hidden="true">8.</strong> Chapter 8 - Dracula takes the boat to England</a></li><li class="chapter-item expanded "><a href="../chapter9/index.html"><strong aria-hidden="true">9.</strong> Chapter 9 - Strange events in England</a></li><li class="chapter-item expanded "><a href="../chapter10/index.html"><strong aria-hidden="true">10.</strong> Chapter 10 - Terrible events in Whitby</a></li><li class="chapter-item expanded "><a href="../chapter11/index.html"><strong aria-hidden="true">11.</strong> Chapter 11 - What's wrong with Lucy?</a></li><li class="chapter-item expanded "><a href="../chapter12/index.html"><strong aria-hidden="true">12.</strong> Chapter 12 - From bad to worse</a></li><li class="chapter-item expanded "><a href="../chapter13/index.html"><strong aria-hidden="true">13.</strong> Chapter 13 - Farewell, Lucy. Meet the new Lucy</a></li><li class="chapter-item expanded "><a href="../chapter14/index.html"><strong aria-hidden="true">14.</strong> Chapter 14 - Jonathan Harker returns</a></li><li class="chapter-item expanded "><a href="../chapter15/index.html"><strong aria-hidden="true">15.</strong> Chapter 15 - Time to start vampire hunting</a></li><li class="chapter-item expanded "><a href="../chapter16/index.html"><strong aria-hidden="true">16.</strong> Chapter 16 - Is Renfield telling the truth?</a></li><li class="chapter-item expanded "><a href="../chapter17/index.html"><strong aria-hidden="true">17.</strong> Chapter 17 - Poor Renfield. Poor Mina.</a></li><li class="chapter-item expanded "><a href="../chapter18/index.html"><strong aria-hidden="true">18.</strong> Chapter 18 - Using Dracula's own weapon against him</a></li><li class="chapter-item expanded "><a href="../chapter19/index.html"><strong aria-hidden="true">19.</strong> Chapter 19 - Dracula escapes</a></li><li class="chapter-item expanded "><a href="../chapter20/index.html"><strong aria-hidden="true">20.</strong> Chapter 20 - The final battle</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <hr />
<h2 id="tags-multiple-inheritance-polymorphism"><a class="header" href="#tags-multiple-inheritance-polymorphism">tags: Multiple Inheritance, Polymorphism</a></h2>
<h1 id="chapter-8---dracula-takes-the-boat-to-england"><a class="header" href="#chapter-8---dracula-takes-the-boat-to-england">Chapter 8 - Dracula takes the boat to England</a></h1>
<p>We are finally away from Castle Dracula. Here is what happens in this chapter:</p>
<blockquote>
<p>Far away from Castle Dracula, a boat leaves from the city of Varna in Bulgaria, sailing into the Black Sea. It has a <strong>captain, first mate, second mate, cook</strong>, and <strong>five crew</strong>. Dracula is also on the ship inside a coffin, but the crew don't know that he's there. Every night Dracula leaves his coffin, and every night one of the men disappears. They become afraid but don't know what is happening or what to do. One crewman tells the others that he saw a strange man walking around the deck, but the others don't believe him.</p>
<p>The days go by and more and more sailors disappear...</p>
<p>Finally it's the last day before the ship reaches the city of Whitby in England, but the captain is alone - all the others have disappeared. The captain knows the truth now. He ties his hands to the wheel so that the ship will go straight even if Dracula finds him.</p>
<p>The next day the people in Whitby see a ship hit the beach, and a wolf jumps off and runs onto the shore - it's Dracula disguised as a wolf. People find the dead captain tied to the wheel with a notebook in his hand and start to read the story.</p>
<p>Meanwhile, Mina and her friend Lucy are in Whitby on vacation...</p>
</blockquote>
<h2 id="multiple-inheritance-defaults-and-the-overloaded-keyword"><a class="header" href="#multiple-inheritance-defaults-and-the-overloaded-keyword">Multiple inheritance, defaults, and the overloaded keyword</a></h2>
<p>While Dracula arrives at Whitby, let's learn about multiple inheritance. We know that you can <code>extend</code> a type on another, and we have done this many times: <code>Person</code> on <code>NPC</code>, <code>Place</code> on <code>City</code>, etc. Multiple inheritance means to do this with more than one type at the same time.</p>
<p>We'll try some multiple inheritance with the ship's crew. The book doesn't give them any names, so we will give them numbers instead. Most <code>Person</code> types won't need a number, so we'll create an abstract type called <code>HasNumber</code> only for types that need a number:</p>
<pre><code class="language-sdl">abstract type HasNumber {
  required number: int16;
}
</code></pre>
<p>Now let's put the <code>Crewman</code> type together, which will use multiple inheritance. Multiple inheritance is very simple: just add a comma between every type you want to extend.</p>
<pre><code class="language-sdl">type Crewman extending HasNumber, Person;
</code></pre>
<p>However, here we have a problem: we never learn the names of the crewmen in the book, but the property <code>name</code> on <code>Person</code> is required. We know that every <code>Crewman</code> object will have a <code>number</code>, so it would be nice to use this to give them a name like &quot;Crewman 1&quot;, &quot;Crewman 2&quot;, and so on. How can we make this happen?</p>
<p>We can make this happen by giving <code>name</code> a default for the <code>Crewman</code> type. To give a default value, just add <code>{}</code> after the parameter and then give an expression for the default value. So far that gives us a <code>Crewman</code> type that looks like the code below. However, a migration won't quite work yet. Can you guess why?</p>
<pre><code class="language-sdl">type Crewman extending HasNumber, Person {
  name: str {
    default := '' ++ &lt;str&gt;.number;
  }
}
</code></pre>
<p>Fortunately, the error message tells us <em>exactly</em> what to do.</p>
<pre><code>error: property 'name' of object type 'default::Crewman' must be declared using the `overloaded` keyword because it is defined in the following ancestor(s): default::Person
  ┌─ c:\rust\easy-edgedb\dbschema\default.esdl:6:5
  │
6 │ ╭     name: str {
7 │ │       default := '' ++ &lt;str&gt;.number;
8 │ │     }
  │ ╰─────^ error
</code></pre>
<p>In other words, <code>Person</code> is where the definition for <code>name</code> is, and this definition doesn't include any information about a default value. We still want to use <code>name</code>, but in a slightly different way. That's where the word <code>overloaded</code> comes in. Adding <code>overloaded</code> will keep the other rules for <code>name</code> (that it must be a <code>str</code>, and that it must be <code>exclusive</code>) and will add our new specification that it will have a <code>default</code> value for the <code>Crewman</code> type. So just add <code>overloaded</code> and our work is done!</p>
<pre><code class="language-sdl">type Crewman extending HasNumber, Person {
  overloaded name: str {
    default := 'Crewman ' ++ &lt;str&gt;.number;
  }
}
</code></pre>
<p>Next is the <code>Sailor</code> type. The sailors have ranks, so first we will make an enum for that:</p>
<pre><code class="language-sdl">scalar type Rank extending enum&lt;Captain, FirstMate, SecondMate, Cook&gt;;
</code></pre>
<p>And then we will make a <code>Sailor</code> type that uses <code>Person</code> and this <code>Rank</code> enum. The sailors in the book all have their own names, so we don't need to overload their <code>name</code> keyword.</p>
<pre><code class="language-sdl">type Sailor extending Person {
  rank: Rank;
}
</code></pre>
<p>Then we will make a <code>Ship</code> type to hold them all. As we saw in this chapter, a <code>Ship</code> object can move on its own even if all of its sailors and crewmen are dead, so we won't make its sailors or crew <code>required</code>.</p>
<pre><code class="language-sdl">type Ship {
  required name: str;
  multi sailors: Sailor;
  multi crew: Crewman;
}
</code></pre>
<p>With all those changes done, let's do a migration.</p>
<p>Now that we have the <code>Crewman</code> type and it doesn't need a name, it's super easy to insert our crewmen thanks to <code>count()</code>. We just do this five times:</p>
<pre><code class="language-edgeql">with next_number := count(Crewman) + 1,
  insert Crewman {
  number := next_number
};
</code></pre>
<p>So if there are no <code>Crewman</code> types, he will get the number 1. The next will get 2, and so on. After the five inserts we can <code>select Crewman {name, number};</code> to see the result. It gives us:</p>
<pre><code>{
  default::Crewman {name: 'Crewman 1', number: 1},
  default::Crewman {name: 'Crewman 2', number: 2},
  default::Crewman {name: 'Crewman 3', number: 3},
  default::Crewman {name: 'Crewman 4', number: 4},
  default::Crewman {name: 'Crewman 5', number: 5},
}
</code></pre>
<p>Now to insert the sailors we just give them each a name and choose a rank from the enum. Let's mix up the enums between <code>str</code> and proper enum input to remind ourselves that EdgeDB will accept either one.</p>
<pre><code class="language-edgeql">insert Sailor {
  name := 'The Captain',
  rank := 'Captain'
};

insert Sailor {
  name := 'Petrofsky',
  rank := 'FirstMate'
};

insert Sailor {
  name := 'The Second Mate',
  rank := Rank.SecondMate
};

insert Sailor {
  name := 'The Cook',
  rank := Rank.Cook
};
</code></pre>
<p>Finally we have to insert a <code>Ship</code> to hold them all. This <code>insert</code> is easy because right now every <code>Sailor</code> and every <code>Crewman</code> type is part of this ship - we don't need to <code>filter</code> anywhere.</p>
<pre><code class="language-edgeql">insert Ship {
  name := 'The Demeter',
  sailors := Sailor,
  crew := Crewman
};
</code></pre>
<p>Then we can look up the <code>Ship</code> to make sure that the whole crew is there:</p>
<pre><code class="language-edgeql">select Ship {
  name,
  sailors: {
    name,
    rank,
  },
  crew: {
    name,
    number
  },
};
</code></pre>
<p>The result is:</p>
<pre><code>{
  default::Ship {
    name: 'The Demeter',
    sailors: {
      default::Sailor {name: 'The Captain', rank: Captain},
      default::Sailor {name: 'Petrofsky', rank: FirstMate},
      default::Sailor {name: 'The Second Mate', rank: SecondMate},
      default::Sailor {name: 'The Cook', rank: Cook},
    },
    crew: {
      default::Crewman {name: 'Crewman 1', number: 1},
      default::Crewman {name: 'Crewman 2', number: 2},
      default::Crewman {name: 'Crewman 3', number: 3},
      default::Crewman {name: 'Crewman 4', number: 4},
      default::Crewman {name: 'Crewman 5', number: 5},
    },
  },
}
</code></pre>
<h2 id="using-the-is-keyword-to-query-multiple-types"><a class="header" href="#using-the-is-keyword-to-query-multiple-types">Using the 'is' keyword to query multiple types</a></h2>
<p>We now have quite a few types that extend the <code>Person</code> type, many with their own properties. The <code>Crewman</code> type has a property <code>number</code>, while the <code>NPC</code> type has a property called <code>age</code>. But since the <code>Person</code> type itself doesn't have the properties <code>age</code> or <code>number</code>, we can't just make a <code>Person</code> shape that includes them:</p>
<pre><code class="language-edgeql">select Person {
  name,
  age,
  number,
};
</code></pre>
<p>The error is:</p>
<pre><code>error: InvalidReferenceError: object type 'default::Person'
has no link or property 'age'
</code></pre>
<p>It looks like the only property of the three that we can put in this query is <code>name</code>. That feels pretty limiting!</p>
<pre><code class="language-edgeql">select Person {
  name
};
</code></pre>
<p>So is there a way to include <code>age</code> if the type is an <code>NPC</code> and <code>number</code> if the type is a <code>Crewman</code>? Yes, there is! We can use the <code>is</code> keyword inside square brackets to specify the type. Here's how it works in our query on <code>Person</code> objects:</p>
<ul>
<li><code>.name</code>: this stays the same, because <code>Person</code> has this property</li>
<li><code>.age</code>: this belongs to the <code>NPC</code> type, so change it to <code>[is NPC].age</code></li>
<li><code>.number</code>: this belongs to the <code>Crewman</code> type, so change it to <code>[is Crewman].number</code></li>
</ul>
<p>Now it will work:</p>
<pre><code class="language-edgeql">select Person {
  name,
  [is NPC].age,
  [is Crewman].number,
};
</code></pre>
<p>The output is now quite large, so here's just a part of it. You'll notice that types that don't have a property or a link will return an empty set: <code>{}</code>. So the <code>Crewman</code> objects have an <code>age: {}</code> while other objects have a <code>number: {}</code>.</p>
<pre><code>{
  # ... /snip
  default::Crewman {name: 'Crewman 4', age: {}, number: 4},
  default::Crewman {name: 'Crewman 5', age: {}, number: 5},
  default::PC {name: 'Emil Sinclair', age: {}, number: {}},
  default::NPC {name: 'The innkeeper', age: 30, number: {}},
  default::NPC {name: 'Mina Murray', age: {}, number: {}},
  default::NPC {name: 'Jonathan Harker', age: {}, number: {}},
}
</code></pre>
<p>This is officially called a {ref}<code>polymorphic query &lt;docs:ref_eql_select_polymorphic&gt;</code>, and is one of the best reasons to use abstract types in your schema.</p>
<h2 id="using-type-to-get-the-type"><a class="header" href="#using-type-to-get-the-type">Using <strong>type</strong> to get the type</a></h2>
<p>Let's do a quick experiment with the same query as above, except with the <code>&lt;json&gt;</code> cast. What differences do you notice?</p>
<pre><code class="language-edgeql">select &lt;json&gt;Person {
  name,
  [is NPC].age,
  [is Crewman].number,
};
</code></pre>
<p>Here is part of the output:</p>
<pre><code>{&quot;age&quot;: null, &quot;name&quot;: &quot;Emil Sinclair&quot;, &quot;number&quot;: null}
{&quot;age&quot;: null, &quot;name&quot;: &quot;Vampire Woman 1&quot;, &quot;number&quot;: null}
{&quot;age&quot;: null, &quot;name&quot;: &quot;The Captain&quot;, &quot;number&quot;: null}
{&quot;age&quot;: null, &quot;name&quot;: null, &quot;number&quot;: 1}
</code></pre>
<p>The type information is all gone! This makes sense because a JSON object is just a bunch of keys and values, and with a concrete query like <code>PC</code> this would be no problem. But this query includes various object types extending <code>Person</code> and it's hard to tell which type is which. Fortunately, we can put the type information by adding <code>__type__</code> which is used to refer to an object's own type:</p>
<pre><code class="language-edgeql">select &lt;json&gt;Person {
  name,
  [is NPC].age,
  [is Crewman].number,
  __type__
};
</code></pre>
<p>The result is close to what we want, but not quite. Take a look at two of the results:</p>
<pre><code>{
  &quot;age&quot;: null,
  &quot;name&quot;: &quot;Emil Sinclair&quot;,
  &quot;number&quot;: null,
  &quot;__type__&quot;: {&quot;id&quot;: &quot;4a007f07-f91f-11ed-8096-7bf54ff85912&quot;}
}
{
  &quot;age&quot;: null,
  &quot;name&quot;: &quot;The Captain&quot;,
  &quot;number&quot;: null,
  &quot;__type__&quot;: {&quot;id&quot;: &quot;48b9bb2f-faaa-11ed-966c-6fc3482a7805&quot;}
}
</code></pre>
<p>The <code>id</code> property shows us that they are two different types, but the type name isn't readable. To fix this, we can add the <code>name</code> property after <code>__type__</code> to display this instead of the id.</p>
<pre><code class="language-edgeql">select &lt;json&gt;Person {
  name,
  [is NPC].age,
  [is Crewman].number,
  __type__: {
    name
  }
};
</code></pre>
<p>And now the two objects from out previous output have human-readble names.</p>
<pre><code>{&quot;age&quot;: null, &quot;name&quot;: &quot;Emil Sinclair&quot;, &quot;number&quot;: null, &quot;__type__&quot;: {&quot;name&quot;: &quot;default::PC&quot;}}
{&quot;age&quot;: null, &quot;name&quot;: &quot;The Captain&quot;, &quot;number&quot;: null, &quot;__type__&quot;: {&quot;name&quot;: &quot;default::Sailor&quot;}}
</code></pre>
<p>So what is <code>__type__</code>, exactly? Well, it's a link that all objects have that are used to describe it. You can see this if you type <code>describe type PC as text;</code> (or with any other object in the schema). Inside the description returned you'll see this:</p>
<pre><code>required single link __type__: schema::ObjectType {
    readonly := true;
};
</code></pre>
<p>Interesting! So it's just an object that can be queried like any other. Let's give it a try with <code>PC</code> and the splat operator to see everything inside:</p>
<pre><code class="language-edgeql">select PC.__type__ {*};
</code></pre>
<p>This will show all of the properties for <code>ObjectType</code>, including the <code>name</code>:</p>
<pre><code>{
  schema::ObjectType {
    id: c7c1983a-268c-11ee-8c82-c79bbe432a02,
    name: 'default::PC',
    internal: false,
    builtin: false,
    computed_fields: [],
    final: false,
    is_final: false,
    abstract: false,
    is_abstract: false,
    inherited_fields: [],
    from_alias: false,
    is_from_alias: false,
    expr: {},
    compound_type: false,
    is_compound_type: false,
  },
}
</code></pre>
<p>So that can be pretty useful.</p>
<p>But if you <em>really</em> want to understand the inner workings of EdgeDB, try the same query with the double splat operator:</p>
<pre><code>select PC.__type__ {**};
</code></pre>
<p>This will return pages and pages of information. You'll see a link called <code>pointers</code> that points to just about everything: a link to <code>__type__</code>, a link to <code>strength</code>, a link to <code>is_single</code> and that it is a computable made from the expression <code>not exists .lover</code>...and so on and so on. If you want to get a good feel for how EdgeDB works on the inside, definitely grab a cup of coffee and give this query a try!</p>
<h2 id="supertypes-subtypes-and-generic-types"><a class="header" href="#supertypes-subtypes-and-generic-types">Supertypes, subtypes, and generic types</a></h2>
<p>The official name for a type that gets extended by another type is a <code>supertype</code> (meaning 'above type'). The types that extend them are their <code>subtypes</code> ('below types'). You can visualize it like this:</p>
<ul>
<li>abstract type Person (supertype, above)</li>
<li>↳ type PC (subtype, under)</li>
<li>↳ type NPC (subtype, under)</li>
</ul>
<p>Because inheriting a type gives you all of its features, a query on objects with <code>subtype is supertype</code> will always return <code>{true}</code>. In our schema a <code>PC</code> object is always a <code>Person</code>, and an <code>NPC</code> object is always a <code>Person</code>.</p>
<p>Conversely, <code>supertype is subtype</code> will return <code>{true}</code> or <code>{false}</code> depending on the concrete type of each object returned. A <code>Person</code> object <em>might</em> be a <code>PC</code> object, and it <em>might</em> be an <code>NPC</code> object.</p>
<p>To make a query that will check this, just add a shape query with the computed property <code>Person is PC</code> and EdgeDB will tell you:</p>
<pre><code class="language-edgeql">select Person {
    name,
    is_PC := Person is PC,
};
</code></pre>
<p>The output will look like this:</p>
<pre><code>{&quot;name&quot;: &quot;Emil Sinclair&quot;, &quot;is_PC&quot;: true}
{&quot;name&quot;: &quot;Vampire Woman 1&quot;, &quot;is_PC&quot;: false}
{&quot;name&quot;: &quot;Vampire Woman 2&quot;, &quot;is_PC&quot;: false}
# ... and so on
</code></pre>
<p>Now how about the simpler scalar types? It's nice that EdgeDB is strict about type safety and has different types for integers, floats and so on, but what if you just want to know if a number is an integer or a float? We could check to see if an integer is one of any integer types, but this makes for a pretty awkward query:</p>
<pre><code class="language-edgeql">with year := 1893,
select year is int16 or year is int32 or year is int64;
</code></pre>
<p>Output: <code>{true}</code>.</p>
<p>But fortunately these types all {ref}<code>extend from abstract types too &lt;docs:ref_std_abstract_types&gt;</code>, and we can use them. These abstract types all start with <code>any</code>, and are: <code>anytype</code>, <code>anyscalar</code>, <code>anyenum</code>, <code>anytuple</code>, <code>anyint</code>, <code>anyfloat</code>, <code>anyreal</code>. The only one with an unclear name is <code>anyreal</code>: this one means any real number, so both integers and floats, plus the <code>decimal</code> type.</p>
<p>So with that you can change the above input to <code>select 1893 is anyint;</code> and get <code>{true}</code>.</p>
<h2 id="array-vs-multi-property-vs-multi-link"><a class="header" href="#array-vs-multi-property-vs-multi-link">Array vs. multi property vs. multi link</a></h2>
<p>We've seen <code>multi</code> links quite a bit already, and you might be wondering if <code>multi</code> can appear in other places too. The answer is yes. A <code>multi</code> property is like any other property, except that it can have more than one value. For example, our <code>Castle</code> type has an <code>array&lt;int16&gt;</code> for the <code>doors</code> property:</p>
<pre><code class="language-sdl">type Castle extending Place {
  doors: array&lt;int16&gt;;
}
</code></pre>
<p>But it could do something similar with a <code>multi</code> property:</p>
<pre><code class="language-sdl">type Castle extending Place {
  multi doors: int16;
}
</code></pre>
<p>With a <code>multi</code> property you would then insert using <code>{}</code> instead of square brackets for an array:</p>
<pre><code class="language-edgeql">insert Castle {
  name := 'Castle Dracula',
  doors := {6, 19, 10},
};
</code></pre>
<p>Which makes you wonder which is best to use: <code>multi</code> for a multi property, <code>array</code>, or an object type via a link. The answer is... it depends. But here are some good rules of thumb to help you decide which to choose.</p>
<ul>
<li>
<p><code>multi</code> property vs. arrays:</p>
<p>How large is the data you are working with? A <code>multi</code> property is more efficient when you have a lot of data, while arrays are slower. But if you have small sets, then arrays are faster than <code>multi</code> property.</p>
<p>If you want to use indexes and constraints on individual elements, then you should use a <code>multi</code> property. We'll look at indexes in Chapter 16, but for now just know that they are a way of making lookups faster.</p>
<p>If order is important, than an array may be better. It's easier to keep the original order of items in an array.</p>
</li>
<li>
<p><code>multi</code> property vs. linking to objects</p>
<p>Here we'll start with two areas where a <code>multi</code> property is better, and then two areas where objects are better.</p>
<p>First negative for objects: objects are always larger, and here's why. Remember <code>describe type as text</code>? Let's look at one of our types with that again. Here's the <code>Castle</code> type:</p>
<pre><code>{
  'type default::Castle extending default::Place {
    required single link __type__: schema::Type {
        readonly := true;
    };
    optional single property doors: array&lt;std::int16&gt;;
    required single property id: std::uuid {
        readonly := true;
    };
    optional single property important_places: array&lt;std::str&gt;;
    optional single property modern_name: std::str;
    required single property name: std::str;
};',
}
</code></pre>
<p>You'll remember seeing the <code>readonly := true</code> properties, which are created for each object type you make. The <code>__type__</code> link and <code>id</code> property together always make up 32 bytes.</p>
<p>The second negative for objects is similar: underneath, they are more work for the computer. EdgeDB runs on top of PostgreSQL, and a multi link to an object needs an extra &quot;join&quot; (a link table + object table), but a <code>multi</code> property only has one. Also, a &quot;backlink&quot; (you'll see those in Chapter 14) takes more work as well.</p>
<p>Having said that, now here are two positives for objects in comparison.</p>
<p>Are there other types that need to refer to the same values? If so, then it may be better to use an object to keep things consistent. That's why we eventually made <code>places_visited</code> a <code>multi</code> link, for example.</p>
<p>Using objects with an <code>exclusive</code> constraint is more efficient when there is a lot of property value duplication.</p>
</li>
</ul>
<p>So hopefully that explanation should help. You can see that you have a lot of choice, so remembering the points above should help you make a decision. Most of the time, you'll probably have a sense for which one you want.</p>
<p><a href="code.html">Here is all our code so far up to Chapter 8.</a></p>
<!--
Todo: demonstrate turning array<int64> into multi int64 once this resolved:
https://github.com/edgedb/edgedb/issues/5749
 -->
<!-- quiz-start -->
<h2 id="time-to-practice"><a class="header" href="#time-to-practice">Time to practice</a></h2>
<ol>
<li>
<p>How would you select all the <code>Place</code> types and their names, plus the <code>doors</code> property if it's a <code>Castle</code>?</p>
</li>
<li>
<p>How would you select <code>Place</code> types with <code>city_name</code> for <code>name</code> if it's a <code>City</code> and <code>country_name</code> for <code>name</code> if it's a <code>Country</code>?</p>
</li>
<li>
<p>How would you do the same but only showing the results of <code>City</code> and <code>Country</code> types?</p>
</li>
<li>
<p>How would you display all the <code>Person</code> types that don't have <code>lover</code>s, with their names and their type names?</p>
</li>
<li>
<p>What needs to be fixed in this query? Hint: two things definitely need to be fixed, while one more should probably be changed to make it more readable.</p>
<pre><code class="language-edgeql">select Place {
  __type__,
  name
  [is Castle]doors
};
</code></pre>
</li>
</ol>
<p><a href="answers.html">See the answers here.</a></p>
<!-- quiz-end -->
<p><strong>Up next:</strong> <em>Time to meet Dr. Seward, Arthur Holmwood, and Quincey Morris...and the strange Renfield.</em></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../chapter7/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../chapter9/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../chapter7/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../chapter9/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
